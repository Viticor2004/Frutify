

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ventas</title>
    <link rel="stylesheet" href="ventas.css">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script>
      var frutasResultado;
      var verdurasResultado;
      var ventaMensual;
      var ventaSemanal;
      var frutasGeneroResultado;
      var verdurasGeneroResultado;
      fetch('ventas.json')
        .then(response => response.json())
        .then(data => {
         
         
         
          google.charts.load('current', {'packages':['corechart']});
          google.charts.load('current', {packages: ['corechart', 'bar']});
         
          const ventasFrutasAnuales=data.frutas_anuales;
          const ventasVerdurasAnuales=data.verduras_anuales;
          const vMensuales=data.ventas_mensuales;
          const vSemanales=data.ventas_semanales;
      
    
         


          //Llamadas
          google.charts.setOnLoadCallback(frutasAnual);
          google.charts.setOnLoadCallback(verdurasAnual);
          google.charts.setOnLoadCallback(ventasFrutasGenero);
          google.charts.setOnLoadCallback(ventasVerdurasGenero);
          google.charts.setOnLoadCallback(ventasMensual);
          google.charts.setOnLoadCallback(ventasSemanal);

          

          var frutasAnuales=[];
          var verdurasAnuales=[];
          var ventasMensuales=[];
         
         
          const acumuladorFrutas = {};
          const acumuladorVerduras={};
          const acumuladorFrutasGenero={};
          const acumuladorVerdurasGenero={};
          const acumuladorMensual={};
          
          ventasFrutasAnuales.forEach(({ producto, cantidad }) => {
            if (acumuladorFrutas[producto]) {
              acumuladorFrutas[producto] += cantidad;
            } else {
              acumuladorFrutas[producto] = cantidad;
            }
          });

          
          
          frutasResultado = Object.entries(acumuladorFrutas);
         



          ventasVerdurasAnuales.forEach(({ producto, cantidad }) => {
            if (acumuladorVerduras[producto]) {
              acumuladorVerduras[producto] += cantidad;
            } else {
              acumuladorVerduras[producto] = cantidad;
            }
          });


          verdurasResultado = Object.entries(acumuladorVerduras);


        

          ventasFrutasAnuales.forEach(({ producto, cantidad, genero }) => {
            if (!acumuladorFrutasGenero[producto]) {
              acumuladorFrutasGenero[producto] = { Masculino: 0, Femenino: 0 };
            }
            acumuladorFrutasGenero[producto][genero] += cantidad;
          });

         
          frutasGeneroResultado = Object.entries(acumuladorFrutasGenero).map(([producto, generos]) => [
            producto, 
            generos.Masculino, 
            generos.Femenino
          ]);



          //ventasVerdurasGenero


          ventasVerdurasAnuales.forEach(({ producto, cantidad, genero }) => {
            if (!acumuladorVerdurasGenero[producto]) {
              acumuladorVerdurasGenero[producto] = { Masculino: 0, Femenino: 0 };
            }
            acumuladorVerdurasGenero[producto][genero] += cantidad;
          });

         
          verdurasGeneroResultado = Object.entries(acumuladorVerdurasGenero).map(([producto, generos]) => [
            producto, 
            generos.Masculino, 
            generos.Femenino
          ]);



          //ventaMensual

          ventaMensual=[];
          vMensuales.forEach(venta=>{
            ventaMensual.push([venta.mes,venta.frutas,venta.verduras]);
          });

      
          //ventaSemanal
          ventaSemanal=[];
          vSemanales.forEach(venta=>{
            ventaSemanal.push([venta.dia,venta.frutas,venta.verduras]);
          });
         


          function frutasAnual() {


            var data = google.visualization.arrayToDataTable([
              ['Frutas', 'Frutas/año'],
              ...frutasResultado
            ]);


           


            var options = {
              title: 'Frutas vendidas por año'
            };


            var chart = new google.visualization.PieChart(document.getElementById('frutasAnual'));


            chart.draw(data, options);
          }


          function verdurasAnual() {


            var data = google.visualization.arrayToDataTable([
              ['Frutas', 'Frutas/año'],
              ...verdurasResultado
            ]);

            var options = {
              title: 'Verduras vendidas por año'
            };


            var chart = new google.visualization.PieChart(document.getElementById('verdurasAnual'));


            chart.draw(data, options);
          }



          //Función para dibujar el gráfico de ventas por género
          function ventasFrutasGenero() {
            var data = google.visualization.arrayToDataTable([
            ['Fruta', 'Hombres', 'Mujeres'],
            ...frutasGeneroResultado
            ]);

            var materialOptions = {
            chart: {
              title: 'Venta anual de frutas por género',
              subtitle: ''
            },
            hAxis: {
              title: 'Cantidad vendida',
              minValue: 0,
            },
            vAxis: {
              title: 'Frutas'
            },
            bars: 'horizontal', // tipo de barra horizontal
            };

            var materialChart = new google.charts.Bar(document.getElementById('ventasFrutasGenero'));
            materialChart.draw(data, materialOptions);
          }
          function ventasVerdurasGenero() {
            var data = google.visualization.arrayToDataTable([
            ['Fruta', 'Hombres', 'Mujeres'],
            ...verdurasGeneroResultado
            ]);

            var materialOptions = {
            chart: {
              title: 'Venta anual de verduras por género',
              subtitle: ''
            },
            hAxis: {
              title: 'Cantidad vendida',
              minValue: 0,
            },
            vAxis: {
              title: 'Frutas'
            },
            bars: 'horizontal', // tipo de barra horizontal
            };

            var materialChart = new google.charts.Bar(document.getElementById('ventasVerdurasGenero'));
            materialChart.draw(data, materialOptions);
          }





          function ventasMensual() {
            
            // Create the data table.
            var data=google.visualization.arrayToDataTable([
              ['Mes', 'Frutas','Verduras'],
              ...ventaMensual
            ]);


            // Set chart options
            var options = {
              title: 'Ventas mensuales',
              curveType: 'function', // Suaviza las líneas
              legend: { position: 'bottom' },
              bar: {groupWidth:'100%'}
            };

            // Instantiate and draw our chart, passing in some options.
            var chart = new google.visualization.ColumnChart(document.getElementById('ventasMensual'));
            chart.draw(data, options);
          }
          function ventasSemanal() {
            
            // Create the data table.
            var data=google.visualization.arrayToDataTable([
              ['Dia', 'Frutas','Verduras'],
              ...ventaSemanal
            ]);


            // Set chart options
            var options = {
              title: 'Ventas semanales',
              curveType: 'function', // Suaviza las líneas
              legend: { position: 'bottom' },
              bar: {groupWidth:'100%'}
            };

            // Instantiate and draw our chart, passing in some options.
            var chart = new google.visualization.ColumnChart(document.getElementById('ventasSemanal'));
            chart.draw(data, options);
          }

          
          
          


        });

      
    </script>

    
    


</head>
<body>
    <div class="contenedor">
        <ul>
            <button>&nbsp;&nbsp;Stock</button>
            <button>&nbsp;&nbsp;Productos vendidos</button>
        </ul>


        <section>
          <div id="frutasAnual" style="width:700px;height: 600px;outline: 2px solid blue;display: flex;z-index: 1;"></div>
          <button id="frutas_resultado">Exportar</button> 
          <div id="verdurasAnual" style="width:700px;height: 600px;outline: 2px solid red;display: flex;z-index: 1;"></div>
          <button id="verduras_resultado">Exportar</button>
          <div id="ventasMensual" style="width: 700px;height: 600px;"></div>
          <button id="mensuales_resultado">Exportar</button>
          <div id="ventasSemanal" style="width: 700px;height: 600px;"></div>
          <button id="semanales_resultado">Exportar</button>


          <div id="ventasFrutasGenero" style="width: 700px;height: 600px;"></div>
          <button id="frutas_genero_resultado">Exportar</button>
          <div id="ventasVerdurasGenero" style="width: 700px;height: 600px;"></div>
          <button id="verduras_genero_resultado">Exportar</button>
         
        </section>
    </div>
    <script>
      function exportToCSV(data) {
      
        var csvData = [];
        var headers = data.getColumnLabel(0) + "," + data.getColumnLabel(1);
        csvData.push(headers);


        for (var i = 0; i < data.getNumberOfRows(); i++) {
          var row = data.getValue(i, 0) + "," + data.getValue(i, 1);
          csvData.push(row);
        }


        var csvString = csvData.join("\n");
        var blob = new Blob([csvString], { type: "text/csv" });
        var link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "ventas.csv";
        link.click();
      }


      //poner este codigo al final de las funciones creadas y además crear dentro del body el boton con id=export-csv
      document.getElementById("frutas_resultado").addEventListener("click", function() {

        var data = google.visualization.arrayToDataTable([
              ['Frutas', 'Frutas/año'],
              ...frutasResultado
        ]);
        exportToCSV(data);
      });
      document.getElementById("verduras_resultado").addEventListener("click", function() {
        var data = google.visualization.arrayToDataTable([
               ['Frutas', 'Frutas/año'],
               ...verdurasResultado
        ]);
        exportToCSV(data);
      });
      document.getElementById("mensuales_resultado").addEventListener("click", function() {
        var data = google.visualization.arrayToDataTable([
              ['Mes', 'Frutas','Verduras'],
               ...ventaMensual
        ]);
        exportToCSV(data);
      });
      document.getElementById("semanales_resultado").addEventListener("click", function() {
        var data = google.visualization.arrayToDataTable([
              ['Dia', 'Frutas','Verduras'],
               ...ventaSemanal
        ]);
        exportToCSV(data);
      });
      document.getElementById("frutas_genero_resultado").addEventListener("click", function() {
        var data = google.visualization.arrayToDataTable([
             ['Fruta', 'Hombres', 'Mujeres'],
             ...frutasGeneroResultado
        ]);
        exportToCSV(data);
      });
      document.getElementById("verduras_genero_resultado").addEventListener("click", function() {
        var data = google.visualization.arrayToDataTable([
             ['Verdura', 'Hombres', 'Mujeres'],
             ...verdurasGeneroResultado
        ]);
        exportToCSV(data);
      });
    </script>
</body>
</html>
