<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="producto.css">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Producto</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<script>

        function mostrarFruta() {
            let tabla = `
                <table>
                    <div>
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Cantidad</th>
                        </tr>
                    </thead>
                    </div>
                    
                    <tbody>
            `;

            fetch('stock.json')
            .then(response=>{
                if(!response.ok){
                    throw new Error('Error');
                }
                return response.json();
            })
            .then(data => {
                
                const frutas=data.frutas;
                


                frutas.forEach(fruta => { 
                    
                        tabla += `
                        <tr>
                            <td>${fruta.id}</td>
                            <td>${fruta.nombre}</td>
                            <td>${fruta.cantidad}</td>
                        </tr>                            
                    `;

                
                });
                tabla += `</tbody></table>`; // Cierra las etiquetas de la tabla
                const panelfruta = document.getElementById("panelfruta");
                panelfruta.innerHTML = tabla;


            })
            .catch(error => {
                    console.error(error);
            });
        }

        // Llama a la función para mostrar los empleados
        mostrarFruta();

        function mostrarVerdura() {
            let tabla = `
                <table>
                    <div>
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Cantidad</th>
                        </tr>
                    </thead>
                    </div>
                    
                    <tbody>
            `;

            fetch('stock.json')
            .then(response=>{
                if(!response.ok){
                    throw new Error('Error');
                }
                return response.json();
            })
            .then(data => {
                
                const verduras=data.verduras;
                


                verduras.forEach(verdura => { 
                    
                        
                        tabla += `
                        <tr>
                            <td>${verdura.id}</td>
                            <td>${verdura.nombre}</td>
                            <td>${verdura.cantidad}</td>
                        </tr>                            
                    `;
                
                });
                tabla += `</tbody></table>`; // Cierra las etiquetas de la tabla
                const panelverdura = document.getElementById("panelverdura");
                panelverdura.innerHTML = tabla;


            })
            .catch(error => {
                    console.error(error);
            });
        }

        // Llama a la función para mostrar los empleados
        mostrarVerdura();


</script>
<body>
    <header>
        <img src="images/iconofrutify.png" alt="Logo">
        <div>
            <a href="logueado.html"><input type="button" id="volverAtras" value="Volver"></a>
            <a href="index.html"><input type="submit" id="cerrarSesion" value="Cerrar Sesión"></a>
        </div>
    </header>
    <div class="contenedor">
        <div class="contenedor_h3">
            <h3 id="frutas">Frutas</h3>
            <h3 id="verduras">Verduras</h3>
        </div>
        <div class="paneles">
            <div class="panelfruta" id="panelfruta"></div>
            <h3 id="verdurasMovil">Verduras</h3>
            <div class="panelverdura" id="panelverdura"></div>
        </div>
        <div class="botones">
            <label>Seleccionar Fruta</label>
            <select id="selectFruits"></select>
            <label>Cantidad</label>
            <input type="number" id="cantidad_fruta">
            <label>Seleccionar Verdura</label>
            <select id="selectVegetables"></select>
            <label>Cantidad</label>
            <input type="number" id="cantidad_verdura">
            <button id="comprar">Comprar</button>

            <!-- Añadir -->
            <label>Nombre de la nueva fruta</label>
            <input type="text" id="nombre_nuevo_producto_fruta">
            <label>Cantidad</label>
            <input type="number" id="cantidad_nuevo_producto_fruta">
            <button id="anadir_fruta">Añadir nuevo producto</button>

            <label>Nombre de la nueva verdura</label>
            <input type="text" id="nombre_nuevo_producto_verdura">
            <label>Cantidad</label>
            <input type="number" id="cantidad_nuevo_producto_verdura">
            <button id="anadir_verdura">Añadir nuevo producto</button>

            <!-- Eliminar -->
            <label>Nombre de la fruta a eliminar</label>
            <input type="text" id="eliminar_fru">
            <button id="eliminar_fruta">Eliminar fruta</button>

            <label>Nombre de la verdura a eliminar</label>
            <input type="text" id="eliminar_verd">
            <button id="eliminar_verdura">Eliminar verdura</button>

            <!-- Modificar -->
            <label>Nombre de la fruta a modificar</label>
            <input type="text" id="nombre_stock_fruta">
            <label>Nuevo stock</label>
            <input type="number" id="stock_fruta">
            <button id="modificar_stock_fruta">Modificar stock</button>

            <label>Nombre de la verdura a modificar</label>
            <input type="text" id="nombre_stock_verdura">
            <label>Nuevo stock</label>
            <input type="number" id="stock_verdura">
            <button id="modificar_stock_verdura">Modificar stock</button>
        </div>
    </div>
</body>
<script>
    const nombre = localStorage.getItem('nombre');
    console.log(nombre);
    function anadirFrutasOpciones(){
        let opcionesFrutas = "";
        const opciones = document.getElementById("selectFruits");
        for(let x = 0; x < frutas.length; x++){
            opcionesFrutas += `<option value='${frutas[x][0]}'>${frutas[x][0]}</option>`;
        }
        opciones.innerHTML = opcionesFrutas;
    }
    function anadirVerdurasOpciones(){
        let opcionesVerduras = "";
        const opciones = document.getElementById("selectVegetables");
        for(let x = 0; x < verduras.length; x++){
            opcionesVerduras += `<option value='${verduras[x][0]}'>${verduras[x][0]}</option>`;
        }
        opciones.innerHTML = opcionesVerduras;
    }
    function comprar(){
        const botonComprar = document.getElementById("comprar");
        botonComprar.addEventListener('click', function(){
            const selectFruits = document.getElementById("selectFruits");
            const selectedOptionFruits = selectFruits.options[selectFruits.selectedIndex];
            const valueSeleccionadoFruta = selectedOptionFruits.value;
            const selectVegetables = document.getElementById("selectVegetables");
            const selectedOptionVegetables = selectVegetables.options[selectVegetables.selectedIndex];
            const valueSeleccionadoVerdura = selectedOptionVegetables.value;
            const quantityFruits = parseInt(document.getElementById("cantidad_fruta").value);
            const quantityVegetables = parseInt(document.getElementById("cantidad_verdura").value);
            fetch('stock.json')
            .then(response => response.json())
            .then(data => {
                let nuevaURL = `http://localhost:3000/comprar/producto`;
                let frutasboolean = false;
                let verdurasboolean = false;
                const frutasDatos = data.frutas;
                const verdurasDatos = data.verduras;
                frutasDatos.forEach(fruta => {
                    if(valueSeleccionadoFruta === fruta.nombre && quantityFruits <= fruta.cantidad && quantityFruits >= 0 ){
                        nuevaURL += `/${valueSeleccionadoFruta}/${quantityFruits}`;
                        frutasboolean = true;
                    }
                });
                verdurasDatos.forEach(verdura => {
                    if(valueSeleccionadoVerdura === verdura.nombre &&  quantityVegetables <= verdura.cantidad && quantityVegetables >= 0 ){
                        nuevaURL += `/${valueSeleccionadoVerdura}/${quantityVegetables}`;
                        verdurasboolean = true;
                    }
                });
                const usuario = localStorage.getItem('nombre');
                const genero = "Hombre";
                nuevaURL += `/${usuario}/${genero}`;
                if (frutasboolean && verdurasboolean){
                    fetch(nuevaURL)
                    .then(response => response.text())
                    .then(data => {})
                    .catch(error => console.error(error));
                    alert("Comprado con éxito");
                } else {
                    alert("Por favor, ingresa una cantidad válida.");
                }
            });
        });
    }
    comprar();
    function anadirFruta(){
        const botonAnadir = document.getElementById("anadir_fruta");
        botonAnadir.addEventListener('click', function(){
            const nuevoProductoFruta = document.getElementById("nombre_nuevo_producto_fruta").value;
            const cantidadNuevoProductoFruta = document.getElementById("cantidad_nuevo_producto_fruta").value;
            let nuevaURL = `http://localhost:3000/anadir/fruta/${nuevoProductoFruta}/${cantidadNuevoProductoFruta}`;
            fetch(nuevaURL)
            .then(response => response.text())
            .then(data => {})
            .catch(error => console.error(error));
            alert("Registrado con éxito");
        });
    }
    anadirFruta();
    function anadirVerdura(){
        const botonAnadir = document.getElementById("anadir_verdura");
        botonAnadir.addEventListener('click', function(){
            const nuevoProductoVerdura = document.getElementById("nombre_nuevo_producto_verdura").value;
            const cantidadNuevoProductoVerdura = document.getElementById("cantidad_nuevo_producto_verdura").value;
            let nuevaURL = `http://localhost:3000/anadir/verdura/${nuevoProductoVerdura}/${cantidadNuevoProductoVerdura}`;
            fetch(nuevaURL)
            .then(response => response.text())
            .then(data => {})
            .catch(error => console.error(error));
            alert("Registrado con éxito");
        });
    }
    anadirVerdura();

    function eliminarFruta(){
        const botonEliminar = document.getElementById("eliminar_fruta");
        botonEliminar.addEventListener('click', function(){
            const eliminarFruta = document.getElementById("eliminar_fru").value;
            let nuevaURL = `http://localhost:3000/eliminar/fruta/${eliminarFruta}`;
            fetch(nuevaURL)
            .then(response => response.text())
            .then(data => {})
            .catch(error => console.error(error));
            alert("Eliminado con éxito");
        });
    }
    eliminarFruta();

    function eliminarVerdura(){
        const botonEliminar = document.getElementById("eliminar_verdura");
        botonEliminar.addEventListener('click', function(){
            const eliminarVerdura = document.getElementById("eliminar_verd").value;
            let nuevaURL = `http://localhost:3000/eliminar/verdura/${eliminarVerdura}`;
            fetch(nuevaURL)
            .then(response => response.text())
            .then(data => {})
            .catch(error => console.error(error));
            alert("Eliminado con éxito");
        });
    }
    eliminarVerdura();

    function modificarStockFruta(){
        const botonStock = document.getElementById("modificar_stock_fruta");
        botonStock.addEventListener('click', function(){
            const nombreStockFruta = document.getElementById("nombre_stock_fruta").value;
            const stockFruta = document.getElementById("stock_fruta").value;
            let nuevaURL = `http://localhost:3000/modificar/stock_fruta/${nombreStockFruta}/${stockFruta}`;
            fetch(nuevaURL)
            .then(response => response.text())
            .then(data => {})
            .catch(error => console.error(error));
            alert("Stock modificado con éxito");
        });
    }
    modificarStockFruta();

    function modificarStockVerdura(){
        const botonStock = document.getElementById("modificar_stock_verdura");
        botonStock.addEventListener('click', function(){
            const nombreStockVerdura = document.getElementById("nombre_stock_verdura").value;
            const stockVerdura = document.getElementById("stock_verdura").value;
            let nuevaURL = `http://localhost:3000/modificar/stock_verdura/${nombreStockVerdura}/${stockVerdura}`;
            fetch(nuevaURL)
            .then(response => response.text())
            .then(data => {})
            .catch(error => console.error(error));
            alert("Stock modificado con éxito");
        });
    }
    modificarStockVerdura();
</script>
</html>