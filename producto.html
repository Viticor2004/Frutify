<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="producto.css">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Producto</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<script>
    const frutas = [];
    const verduras=[];
    fetch('stock.json')
    .then(response => response.json())
    .then(data => {
        google.charts.load('current', {'packages':['corechart']});
        google.charts.load('current', {packages: ['corechart', 'bar']});

        const frutasDatos=data.frutas;
        const verdurasDatos=data.verduras;

        google.charts.setOnLoadCallback(frutasStock);
        google.charts.setOnLoadCallback(verdurasStock);
        

    
        frutasDatos.forEach(fruta => {
            frutas.push([fruta.nombre,fruta.cantidad]);
        });

        verdurasDatos.forEach(verdura => {
            verduras.push([verdura.nombre,verdura.cantidad]);
        });
        
        anadirFrutasOpciones();
        anadirVerdurasOpciones();



        function frutasStock(){
            var data = google.visualization.arrayToDataTable([
            ['Frutas', 'Cantidad',],
            ...frutas
            ]);

            var materialOptions = {
            chart: {
              title: 'Venta anual de verduras por género',
              subtitle: ''
            },
            hAxis: {
              title: 'Cantidad vendida',
              minValue: 0,
            },
            vAxis: {
              title: 'Frutas'
            },
            bars: 'vertical', // tipo de barra horizontal
            };

            var materialChart = new google.charts.Bar(document.getElementById('frutasStock'));
            materialChart.draw(data, materialOptions);
          }

          function verdurasStock() {
            var data = google.visualization.arrayToDataTable([
            ['Verduras', 'Cantidad',],
            ...verduras
            ]);

            var materialOptions = {
            chart: {
              title: 'Venta anual de verduras por género',
              subtitle: ''
            },
            hAxis: {
              title: 'Cantidad vendida',
              minValue: 0,
            },
            vAxis: {
              title: 'Frutas'
            },
            bars: 'vertical', // tipo de barra horizontal
            };

            var materialChart = new google.charts.Bar(document.getElementById('verdurasStock'));
            materialChart.draw(data, materialOptions);
          }
        

    });



</script>

<body>
    
    <div class="contenedor">
        

        <!-- Graficas  -->

        <div id="frutasStock" style="width: 900px;height: 600px;"></div>
        <div id="verdurasStock" style="width: 900px;height: 600px;"></div>


        <!-- Compras -->
        <div class="botones">
            <select id="selectFruits" style="width: 100px;height: 100px;">
                
                
            </select>
            <input type="number" style="width: 100px;height: 100px;" id="cantidad_fruta">
            <select id="selectVegetables" style="width: 100px;height: 100px;">
                
                
            </select>
            <input type="number" style="width: 100px;height: 100px;" id="cantidad_verdura">
            <button id="comprar" style="width: 100px;height: 100px;">Comprar </button>

            <label>Nombre de la nueva fruta a añadir</label>
            <input type="text" id="nombre_nuevo_producto_fruta"><br><br>
            <label>Cantidad del nuevo producto a añadir</label>
            <input type="number" id="cantidad_nuevo_producto_fruta">

            <label>Nombre dde la nueva verdura a añadir</label>
            <input type="text" id="nombre_nuevo_producto_verdura"><br><br>
            <label>Cantidad del nuevo producto a añadir</label>
            <input type="number" id="cantidad_nuevo_producto_verdura">
            <button id="anadir">Anadir nuevo producto</button>

            <label>Nombre de la nueva fruta a eliminar</label>
            <input type="text" id="eliminar_fruta"><br><br>

            <label>Nombre dde la nueva verdura a eliminar</label>
            <input type="text" id="eliminar_verdura"><br><br>
            <button id="eliminar">Eliminar nuevo producto</button>

            <label>Nombre de la fruta del stock que queremos cambiar</label>
            <input type="text" id="nombre_stock_fruta">
            <label>Modificar el stock de la fruta</label>
            <input type="number" id="stock_fruta">
            <label>Nombre de la verdura del stock que queremos cambiar</label>
            <input type="text" id="nombre_stock_verdura">
            <label>Modficar el stock de la verdura</label>
            <input type="number" id="stock_verdura">
            <button id="modificar_stock">Modificar_stock</button>
        </div>
        
    </div>
</body>
<script>
    const nombre = localStorage.getItem('nombre');
    console.log(nombre);
    function anadirFrutasOpciones(){
        let opcionesFrutas="";
        const opciones=document.getElementById("selectFruits");
        
        for(let x=0;x<frutas.length;x++){
            opcionesFrutas += `<option value='${frutas[x][0]}' >${frutas[x][0]}</option>`;
        }
        opciones.innerHTML=opcionesFrutas;
        
    }
    function anadirVerdurasOpciones(){
        let opcionesVerduras="";
        const opciones=document.getElementById("selectVegetables");
        
        for(let x=0;x<verduras.length;x++){
            opcionesVerduras += `<option value='${verduras[x][0]}'>${verduras[x][0]}</option>`;
        }
        opciones.innerHTML=opcionesVerduras ;
        
    }

    function comprar(){
        const botonComprar=document.getElementById("comprar");
        let nuevaURL=`http://localhost:3000/comprar/producto`;
        botonComprar.addEventListener('click',function(){
            

            const selectFruits=document.getElementById("selectFruits");
            const selectedOptionFruits=selectFruits.options[selectFruits.selectedIndex];
            const valueSeleccionadoFruta=selectedOptionFruits.value;

            const selectVegetables=document.getElementById("selectVegetables");
            const selectedOptionVegetables=selectVegetables.options[selectVegetables.selectedIndex];
            const valueSeleccionadoVerdura=selectedOptionVegetables.value;

            const quantityFruits=parseInt(document.getElementById("cantidad_fruta").value);
            const quantityVegetables=parseInt(document.getElementById("cantidad_verdura").value);

            if (isNaN(quantityFruits) || quantityFruits <= 0) {
                alert("Por favor, ingresa una cantidad válida.");
                return;
            }
        
            fetch('stock.json')
            .then(response => response.json())
            .then(data => {
               
                const frutasDatos=data.frutas;
                const verdurasDatos=data.verduras;
                
                frutasDatos.forEach(fruta => {
                    if(valueSeleccionadoFruta===fruta.nombre){
                        nuevaURL+=`/${fruta.nombre}/${quantityFruits}`;
                    }
                    
                });

                verdurasDatos.forEach(verdura => {
                    if(valueSeleccionadoVerdura===verdura.nombre){
                        nuevaURL+=`/${verdura.nombre}/${quantityVegetables}`;
                    }
                });
                //nuevaURL+=
                
                fetch(nuevaURL)
                .then(response => response.text())
                .then(data => {

                })
                .catch(error => {               
                    console.error(error);
                });
                alert("Comprado con éxito");

            });

        });
    }
    comprar();

    function anadirProducto(){
        const botonAnadir=document.getElementById("anadir");
        let nuevaURL=`http://localhost:3000/anadir/producto`;
        botonAnadir.addEventListener('click',function(){
            const nuevoProductoFruta=document.getElementById("nombre_nuevo_producto_fruta").value;
            const cantidadNuevoProductoFruta=document.getElementById("cantidad_nuevo_producto_fruta").value;

            const nuevoProductoVerdura=document.getElementById("nombre_nuevo_producto_verdura").value;
            const cantidadNuevoProductoVerdura=document.getElementById("cantidad_nuevo_producto_verdura").value;

            nuevaURL+=`/${nuevoProductoFruta}/${cantidadNuevoProductoFruta}/${nuevoProductoVerdura}/${cantidadNuevoProductoVerdura}`;

            fetch(nuevaURL)
                .then(response => response.text())
                .then(data => {

                })
                .catch(error => {               
                    console.error(error);
                });
                alert("Registrado con éxito");
            
        });
    }
    anadirProducto();

    function eliminarProducto(){
        const botonEliminar=document.getElementById("eliminar");
        let nuevaURL=`http://localhost:3000/eliminar/producto`;
        botonEliminar.addEventListener('click',function(){
            const eliminarFruta=document.getElementById("eliminar_fruta").value;
            const eliminarVerdura=document.getElementById("eliminar_verdura").value;

            nuevaURL+=`/${eliminarFruta}/${eliminarVerdura}`;
            fetch(nuevaURL)
                .then(response => response.text())
                .then(data => {

                })
                .catch(error => {               
                    console.error(error);
                });
                alert("Eliminado con éxito");

        });

    }
    eliminarProducto();
    function modificarStock(){
        const botonStock=document.getElementById("modificar_stock");
        let nuevaURL=`http://localhost:3000/modificar/stock`;
        botonStock.addEventListener('click',function(){
            
            const nombreStockFruta=document.getElementById("nombre_stock_fruta").value;
            const nombreStockVerdura=document.getElementById("nombre_stock_verdura").value;
            
            const stockFruta=document.getElementById("stock_fruta").value;
            const stockVerdura=document.getElementById("stock_verdura").value;

            nuevaURL+=`/${nombreStockFruta}/${stockFruta}/${nombreStockVerdura}/${stockVerdura}`; 
            fetch(nuevaURL)
            .then(response => response.text())
            .then(data => {

            })
            .catch(error => {               
                console.error(error);
            });
            alert("Stock modificado con éxito");

        });
    }
    modificarStock();

</script>
</html>